# Prompt Skills

## jsonToZodStrict 与 zodToJsonStrict 工作流总结

我们通过几轮迭代开发并修复了复杂的JSON schema和Zod类型转换功能，主要发现和解决的问题包括：

1. **严格模式规则解析**：确保所有字段都必须在required数组中声明，可选字段必须通过`type: ["type", "null"]`显式声明
2. **嵌套对象验证**：解决嵌套对象中非nullable字段错误接受null值的问题
3. **类型验证策略**：通过`superRefine`实现更严格的null值检查，而不仅仅依赖基本类型检查
4. **测试驱动开发**：基于测试用例不断修改代码直到所有测试通过

## 优化工作流

您提出的工作流已经很好，我建议进一步优化：

1. **需求明确化阶段**
   - 提供完整文档和相关代码，包括接口定义、相关依赖和使用示例
   - 明确说明预期功能和边界条件
   - 提供现有问题的具体描述或复现步骤

2. **设计阶段**
   - 让AI归纳实现规则并提出初步设计方案
   - 讨论可能的实现策略和潜在问题
   - 确认设计方案满足所有需求

3. **实现与测试阶段**
   - AI编写初始代码实现和相应测试
   - 运行测试并共享结果
   - 分析失败测试，逐步迭代修复

4. **验证与优化阶段**
   - 确认所有测试通过
   - 讨论代码质量和性能考虑
   - 进行必要的重构和文档补充

## 示例Prompt

```
我需要开发一个在JSON Schema和Zod类型系统之间进行转换的工具。

## 背景和需求
我们使用OpenAI的函数调用功能，它要求遵循严格模式的JSON Schema。我需要能够：
1. 将严格模式的JSON Schema转换为对应的Zod验证模式(jsonToZodStrict)
2. 将Zod模式转换回严格模式的JSON Schema(zodToJsonStrict)

## 严格模式规则
JSON Schema到Zod的转换规则:
- 所有字段必须在required数组中声明
- 可选字段必须使用type: ["type", "null"]格式声明
- 所有对象必须使用strict()防止额外属性
- 不符合规则的schema应该抛出错误

Zod到JSON Schema的转换规则:
- 所有optional()字段转换为类型联合，如type: ["string", "null"]
- 所有字段都标记为required(通过nullable类型处理可选性)
- 所有对象都设置additionalProperties: false

## 示例输入和输出
[提供示例JSON Schema和对应的Zod类型定义]

## 当前工作
我已经有初步实现，但在处理嵌套对象和null值验证时遇到问题。

## 请帮我:
1. 分析需求并设计实现方案
2. 实现jsonToZodStrict和zodToJsonStrict函数
3. 编写全面的测试用例覆盖各种情况
4. 分析可能的边缘情况和如何处理

请在实现过程中特别关注:
- 嵌套对象中非nullable字段的null值验证
- 类型联合处理
- 错误信息的友好性
```

## 提升Prompt效率的建议

1. **提供明确的上下文边界**
   - 说明代码所在项目的背景和目的
   - 明确指出已有的组件和依赖
   - 描述相关代码的使用场景

2. **分解复杂任务**
   - 将大型任务分解为独立步骤
   - 每步设置清晰可验证的预期结果
   - 按顺序逐步完成，避免一次请求过多功能

3. **使用示例驱动开发**
   - 提供具体的输入/输出示例
   - 包含常见情况和边缘情况
   - 使用表格或列表使示例结构清晰

4. **清晰的错误描述**
   - 提供完整的错误信息和堆栈跟踪
   - 描述尝试过的解决方案
   - 解释错误出现的上下文

5. **增量式迭代**
   - 先确认AI对问题的理解是否正确
   - 分批次讨论和实现
   - 每次修改后共享具体测试结果

6. **明确约束条件**
   - 说明性能要求或限制
   - 指出必须兼容的现有系统
   - 提供代码风格指南或特殊规范

这种结构化方法能最大限度地利用AI能力，同时确保开发过程高效且成果符合预期。
